
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>연구 계산기 (모바일 최적화)</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="p-2 bg-gray-100 text-sm font-sans">
  <div class="max-w-4xl mx-auto bg-white p-2 rounded-xl shadow-md">
    <h1 class="text-2xl font-bold text-blue-600 mb-4 text-center">🧪 연구 계산기</h1>

    <div id="researchContainer" class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4"></div>

    <button onclick="calculateAll()" class="w-full mt-4 bg-blue-600 text-white font-bold py-2 rounded hover:bg-blue-700">계산하기</button>

    <div id="result" class="mt-6 font-semibold text-gray-700 whitespace-pre-line text-center"></div>
  </div>

  <script>
    const maxLevels = {
      I: 5,
      II: 8,
      III: 12,
      IV: 12,
      V: 1,
      Healing: 10,
      Training: 10,
      HealingTime: 10
    };

    const columnMap = {
      I: { red: 1, black: 2 },
      II: { red: 3, black: 4 },
      III: { red: 5, black: 6 },
      IV: { red: 7, black: 8 },
      V: { red: 9, black: 10 },
      Healing: { red: 12, black: 13 },
      Training: { red: 14, black: 15 },
      HealingTime: { red: 16, black: 17 }
    };

    function generateLevelOptions(start, end) {
      let options = "";
      for (let i = start; i <= end; i++) {
        options += `<option value="${i}">Lv.${i}</option>`;
      }
      return options;
    }

    function createResearchUI() {
      const container = document.getElementById("researchContainer");

      for (const key in maxLevels) {
        const max = maxLevels[key];
        const html = `
          <div class="border rounded p-4 shadow space-y-2 bg-white">
            <label class="inline-flex items-center space-x-2 mb-2">
              <input type="checkbox" id="check-${key}" class="accent-blue-500">
              <span class="font-bold text-blue-700">${key} 연구</span>
            </label>
            <div class="space-y-2">
              <div>
                <label class="block">현재</label>
                <select id="start-${key}" class="w-full border rounded p-2">
                  ${generateLevelOptions(1, max - 1)}
                </select>
              </div>
              <div>
                <label class="block">목표</label>
                <select id="end-${key}" class="w-full border rounded p-2">
                  ${generateLevelOptions(2, max)}
                </select>
              </div>
            </div>
          </div>
        `;
        container.insertAdjacentHTML("beforeend", html);
      }
    }

    async function fetchCSV(url) {
      const res = await fetch(url);
      const text = await res.text();
      return text.trim().split("\n").map(row => row.split(","));
    }

    async function calculateAll() {
      const data = await fetchCSV("https://raw.githubusercontent.com/s574shinchan/WOS_Calc/1e960927a7b4db6971bcb03227b5fa351ee9d04a/data/research_data.csv");
      let totalRed = 0, totalBlack = 0;

      for (const key in maxLevels) {
        if (!document.getElementById(`check-${key}`).checked) continue;

        const s = parseInt(document.getElementById(`start-${key}`).value);
        const e = parseInt(document.getElementById(`end-${key}`).value);
        if (s >= e) continue;

        const col = columnMap[key];
        for (let i = s - 1; i < e - 1; i++) {
          const row = data[i + 1];
          totalRed += parseInt(row[col.red]?.replace(/,/g, "") || 0);
          totalBlack += parseInt(row[col.black]?.replace(/,/g, "") || 0);
        }
      }

      document.getElementById("result").innerText = 
        totalRed + totalBlack === 0 
        ? "⚠️ 선택된 항목이 없거나 레벨 설정이 잘못되었습니다." 
        : `✅ 선택한 항목 합계\n🔴 불수정: ${totalRed.toLocaleString()}개\n⚫ 철강재: ${totalBlack.toLocaleString()}개`;
    }

    // 초기 UI 생성
    window.onload = createResearchUI;
  </script>
</body>
</html>
