<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>연구 계산기</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="p-2 bg-gray-100 text-sm font-sans">
  <div class="max-w-xl mx-auto bg-white p-2 rounded-xl shadow-md space-y-4">
    <h1 class="text-xl font-bold text-blue-600">🧪 연구 계산기</h1>
    
    <div>
      <label class="block mb-1 font-semibold">연구 항목</label>
      <select id="researchType" class="w-full border p-2 rounded">
        <option value="I">I</option>
        <option value="II">II</option>
        <option value="III">III</option>
        <option value="IV">IV</option>
        <option value="V">V</option>
        <option value="Healing">Healing</option>
        <option value="Training">Training</option>
        <option value="HealingTime">HealingTime</option>
      </select>
    </div>

    <div class="flex gap-2">
      <div class="flex-1">
        <label class="block mb-1 font-semibold">현재 레벨</label>
        <select id="startLevel" class="w-full border p-2 rounded">
          <option value="1">Lv.1</option>
          <option value="2">Lv.2</option>
          <option value="3">Lv.3</option>
          <option value="4">Lv.4</option>
          <option value="5">Lv.5</option>
          <option value="6">Lv.6</option>
          <option value="7">Lv.7</option>
          <option value="8">Lv.8</option>
          <option value="9">Lv.9</option>
          <option value="10">Lv.10</option>
          <option value="11">Lv.11</option>
          <option value="12">Lv.12</option>
        </select>
      </div>
      <div class="flex-1">
        <label class="block mb-1 font-semibold">목표 레벨</label>
        <select id="endLevel" class="w-full border p-2 rounded">
          <option value="2">Lv.2</option>
          <option value="3">Lv.3</option>
          <option value="4">Lv.4</option>
          <option value="5">Lv.5</option>
          <option value="6">Lv.6</option>
          <option value="7">Lv.7</option>
          <option value="8">Lv.8</option>
          <option value="9">Lv.9</option>
          <option value="10">Lv.10</option>
          <option value="11">Lv.11</option>
          <option value="12">Lv.12</option>
        </select>
      </div>
    </div>

    <button onclick="calculate()" class="bg-blue-500 text-white font-semibold py-2 px-4 rounded w-full hover:bg-blue-600">계산</button>

    <div id="result" class="mt-4 font-semibold text-gray-700 whitespace-pre-line"></div>
  </div>

  <script>
    const columnMap = {
      I: { red: 1, black: 2 },
      II: { red: 3, black: 4 },
      III: { red: 5, black: 6 },
      IV: { red: 7, black: 8 },
      V: { red: 9, black: 10 },
      Healing: { red: 12, black: 13 },
      Training: { red: 14, black: 15 },
      HealingTime: { red: 16, black: 17 }
    };

    async function fetchCSV(url) {
      const res = await fetch(url);
      const text = await res.text();
      return text.trim().split("\n").map(row => row.split(","));
    }

    async function calculate() {
      const type = document.getElementById("researchType").value;
      const start = parseInt(document.getElementById("startLevel").value);
      const end = parseInt(document.getElementById("endLevel").value);

      if (start >= end) {
        document.getElementById("result").innerText = "⚠️ 현재 레벨은 목표 레벨보다 작아야 합니다.";
        return;
      }

      const data = await fetchCSV("https://raw.githubusercontent.com/s574shinchan/WOS_Calc/1e960927a7b4db6971bcb03227b5fa351ee9d04a/data/research_data.csv");
      const col = columnMap[type];
      let redSum = 0, blackSum = 0;

      for (let i = start - 1; i < end - 1; i++) {
        const row = data[i + 1];
        redSum += parseInt(row[col.red]?.replace(/,/g, "") || 0);
        blackSum += parseInt(row[col.black]?.replace(/,/g, "") || 0);
      }

      document.getElementById("result").innerText = 
        `🔴 불수정: ${redSum.toLocaleString()}개\n⚫ 정제석: ${blackSum.toLocaleString()}개`;
    }
  </script>
</body>
</html>
